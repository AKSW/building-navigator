<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/BuildingNavigator.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">src</a> BuildingNavigator.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">59.68% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>37/62</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">16.67% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>2/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">66.67% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>12/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">59.68% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>37/62</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import React from 'react';
import Promise from 'promise-polyfill';
import PropTypes from 'prop-types';
&nbsp;
import Logger from './utils/Logger';
import {isMobileBrowser} from './utils/DetectMobile';
import EventHandler from './EventHandler';
import Main from './components/Main';
&nbsp;
/**
 * Logical main class of the app, controls dataflow between components and stores
 *
 * Holds stores, logger and event handler
 * Passes events with handleEvent from components to the event handler and updates its state after the event
 *      Updated state will be passed to the components
 * Extends super class React.Component with logger and handleEvent method
 *      This allows components to call then with:
 *      super.logger.log() and super.handleEvent(event)
 * Do some initial work, like loading building data and if small window
 */
class BuildingNavigator extends React.Component {
    constructor(props) {
        super();
&nbsp;
        // init store state
        this.state = {
            stores: props.stores,
        };
        // set local variables
        this.logger = props.logger;
        this.eventHandler = props.eventHandler;
        this.handleEvent = this.handleEvent.bind(this);
        this.compMounted = false; // requiered to test initial window size
&nbsp;
        // Extend Rect.Component with handleEvent() method
        // allows components to call events with: super.handleEvent(...)
        React.Component.prototype.handleEvent = (event) =&gt; {
            return new Promise((resolve, reject) =&gt; {
                this.handleEvent(event).then(
                    response =&gt; resolve(response),
<span class="fstat-no" title="function not covered" >                    er</span>ror =&gt; <span class="cstat-no" title="statement not covered" >reject(error)</span>
                );
            });
        };
        // Write logger into React.Component, allows components to access it with: super.logger.log(...)
        React.Component.prototype.logger = this.logger;
&nbsp;
        // bind local handlers
        this.handleWindowResize = this.handleWindowResize.bind(this);
        this.handlePopstate = this.handlePopstate.bind(this);
        this.updateMapBounds = this.updateMapBounds.bind(this);
    }
&nbsp;
    /**
     * Do some initial work:
     * add event listeners, may set if is mobile browser, init buildings, may set route
     */
    componentDidMount() {
        const self = this;
        this.compMounted = true;
&nbsp;
        // add resize event listener
        window.addEventListener('resize', this.handleWindowResize);
&nbsp;
        // add popstate listener (if user presses browsers back/forward button, get new current route)
        window.addEventListener("popstate", this.handlePopstate, false);
&nbsp;
        // may set if is small view
        <span class="missing-if-branch" title="if path not taken" >I</span>if (isMobileBrowser()) {
<span class="cstat-no" title="statement not covered" >            this.handleEvent({</span>
                action: 'update-ui-config',
                payload: {key: 'isSmallView', value: true}
            });
        }
&nbsp;
        // load initial buildind data, apply map bounds to the buildings and set initial route
        this.handleEvent({action: 'init-buildings'}).then(() =&gt; {
            this.updateMapBounds();
            // apply bounds to the buildings
            super.handleEvent({action: 'apply-bounds'});
        }).catch(<span class="fstat-no" title="function not covered" >er</span>ror =&gt; {});
&nbsp;
        // hide global loader after this component is mounted
        this.handleEvent({
            action: 'update-ui-config',
            payload: {key: 'loader', value: false}
        });
&nbsp;
        // get current path and set as initial route
        // e.g. sets Search as index component, or 404 if not found
        const currentRoute =this.state.stores.routerStore.getCurrentRoute();
        super.handleEvent({
            action: 'set-current-route',
            payload: {path: currentRoute.path}
        });
&nbsp;
    }
&nbsp;
    componentWillUnmount() {
        window.removeEventListener('resize', this.handleWindowResize);
        window.removeEventListener('popstate', this.handlePopstate);
    }
&nbsp;
    /**
     * Pass event to EventHandler and update my own state
     *
     * @param Object event with action and data object (see EventHandler)
     * @return Promise with response or error
     */
    handleEvent(event) {
        return new Promise((resolve, reject) =&gt; {
            // handle event and resolve promise or reject on error
            this.eventHandler.handleEvent(event).then(
                response =&gt; {
                    this.setState(this.state);
                    resolve(response);
                },
<span class="fstat-no" title="function not covered" >                er</span>ror =&gt; {
<span class="cstat-no" title="statement not covered" >                    this.logger.log(error, event, 'error');</span>
<span class="cstat-no" title="statement not covered" >                    this.setState(this.state);</span>
<span class="cstat-no" title="statement not covered" >                    reject(error);</span>
                }
            );
        });
    }
&nbsp;
    /**
     * Window resize event handler
     */
<span class="fstat-no" title="function not covered" >    ha</span>ndleWindowResize () {
        const isSmallView = <span class="cstat-no" title="statement not covered" >this.state.stores.uiStore.get('isSmallView');</span>
&nbsp;
        // test if its a small view and write to state (after this app was mounted)
<span class="cstat-no" title="statement not covered" >        if (this.compMounted) {</span>
            const appEl = <span class="cstat-no" title="statement not covered" >document.getElementById(this.state.stores.uiStore.get('userConfig').container);</span>
<span class="cstat-no" title="statement not covered" >            if (appEl.offsetWidth &lt;= this.state.stores.uiStore.get('smallViewMax')) {</span>
<span class="cstat-no" title="statement not covered" >                if (!isSmallView) {</span>
<span class="cstat-no" title="statement not covered" >                    this.handleEvent({</span>
                        action: 'update-ui-config',
                        payload: {key: 'isSmallView', value: true}
                    });
                }
            } else {
<span class="cstat-no" title="statement not covered" >                if (isSmallView) {</span>
<span class="cstat-no" title="statement not covered" >                    this.handleEvent({</span>
                        action: 'update-ui-config',
                        payload: {key: 'isSmallView', value: false}
                    });
                }
            }
        }
    }
&nbsp;
    /**
     * Popstate listener. Handles browsers history back function
     */
<span class="fstat-no" title="function not covered" >    ha</span>ndlePopstate () {
        const newStores = <span class="cstat-no" title="statement not covered" >this.state.stores;</span>
<span class="cstat-no" title="statement not covered" >        newStores.filterStore.filters = history.state.filters;</span>
<span class="cstat-no" title="statement not covered" >        newStores.mapStore.config = history.state.map;</span>
<span class="cstat-no" title="statement not covered" >        newStores.uiStore.config = history.state.ui;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        this.setState({stores: newStores});</span>
<span class="cstat-no" title="statement not covered" >        this.eventHandler.stores = newStores;</span>
&nbsp;
        // update map config, bounds and apply filter and bounds to buildings
<span class="cstat-no" title="statement not covered" >        super.handleEvent({</span>
            action: 'update-map-config',
            payload: newStores.mapStore.config
        });
<span class="cstat-no" title="statement not covered" >        super.handleEvent({action: 'apply-filters'});</span>
        // apply bounds after map moved to new bounds
<span class="cstat-no" title="statement not covered" >        window.setTimeout(<span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            this.updateMapBounds();</span>
<span class="cstat-no" title="statement not covered" >            super.handleEvent({action: 'apply-bounds'});</span>
        }, 500);
&nbsp;
&nbsp;
        // set browsers title (required for FF)
<span class="cstat-no" title="statement not covered" >        document.title = history.state.title;</span>
    }
&nbsp;
    /**
     * Update bounds on maps config
     */
    updateMapBounds() {
        const mapNode = this.state.stores.mapStore.getNode();
        <span class="missing-if-branch" title="else path not taken" >E</span>if (mapNode !== null) {
            const mapBounds = mapNode.getBounds().pad(this.state.stores.mapStore.get('mapPadding'));
            // update map bounds config
            super.handleEvent({action: 'update-map-bound',
                payload: {
                    northEast: {
                        latitude: mapBounds._northEast.lat,
                        longitude: mapBounds._northEast.lng,
                    },
                    southWest: {
                        latitude: mapBounds._southWest.lat,
                        longitude: mapBounds._southWest.lng
                    }
                }
            });
        }
    }
&nbsp;
    render() {
        return &lt;Main stores={this.state.stores} /&gt;;
    }
}
&nbsp;
BuildingNavigator.propTypes = {
    stores: PropTypes.object.isRequired,
    logger: PropTypes.instanceOf(Logger).isRequired,
    eventHandler: PropTypes.instanceOf(EventHandler).isRequired,
};
&nbsp;
export default BuildingNavigator;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Nov 28 2018 09:45:59 GMT+0000 (UTC)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
